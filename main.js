(()=>{"use strict";function e(e){e.classList.remove("popup_is-opened"),document.removeEventListener("click",t),document.removeEventListener("keydown",n)}function t(t){t.target.classList.contains("popup_is-opened")&&e(t.target)}function n(t){if("Escape"===t.key){var n=document.querySelector(".popup_is-opened");n&&e(n)}}var o={baseUrl:"https://nomoreparties.co/v1/".concat("wff-cohort-38"),headers:{authorization:"".concat("963414ea-0ced-4516-965e-e8c378c6da30"),"Content-Type":"application/json"}},r=function(e,t,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),a=c.querySelector(".card__image"),i=c.querySelector(".card__like-button"),u=c.querySelector(".card__like-count"),s=c.querySelector(".card__delete-button");return c.dataset.id=e._id,i.dataset.id=e._id,a.src=e.link,a.alt=e.name,u&&e.likes&&r&&(e.likes.some((function(e){return e._id==r}))&&i.classList.add("card__like-button_is-active"),u.textContent=e.likes.length),e.owner._id!=r?s.remove():s.addEventListener("click",(function(){return t(c)})),i.addEventListener("click",(function(){return o(i,u)})),a.addEventListener("click",(function(){return n(e)})),c.querySelector(".card__title").textContent=e.name,c};function c(e,t){var n=e.classList.contains("card__like-button_is-active"),r=n?"DELETE":"PUT";(function(e,t){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:t,headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(e.dataset.id,r).then((function(o){t.textContent=o.likes.length,e.classList.toggle("card__like-button_is-active",!n)})).catch((function(e){console.error(e)}))}var a=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""};function i(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}var u=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){a(e,n,t),n.setCustomValidity("")})),i(n,o,t)},s=document.querySelector(".places__list"),l=document.forms["edit-profile"],d=l.querySelector(".popup__input_type_name"),p=l.querySelector(".popup__input_type_description"),f=document.querySelector(".profile__title"),_=document.querySelector(".profile__description"),m=document.querySelector(".profile__image"),y=document.forms["new-place"],v=y.querySelector(".popup__input_type_card-name"),h=y.querySelector(".popup__input_type_url"),S=document.forms["edit-profile-avatar"],q=document.querySelector(".popup__image"),b=document.querySelector(".popup__caption"),k=document.querySelector(".popup_type_edit"),E=document.querySelector(".popup_type_new-card"),g=document.querySelector(".popup_type_image"),L=document.querySelector(".popup_type_confirm"),C=document.querySelector(".popup_type_edit_profile_avatar"),j=[k,E,g,L,C],x=L.querySelector(".popup__button_confirm"),P=document.querySelector(".profile__image_button-edit"),A=null,U=null,T=null,w=[document.querySelector(".profile__edit-button"),document.querySelector(".profile__add-button")],B=document.querySelectorAll(".popup__close"),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"};function N(e){J(L),A=e.dataset.id,U=e}function O(e){b.textContent=e.name,q.alt=e.name,q.src=e.link,J(g)}function J(e){e===k?(d.value=document.querySelector(".profile__title").textContent,p.value=document.querySelector(".profile__description").textContent,u(l,D)):e===E?(y.reset(),u(y,D)):e===C&&(S.reset(),u(S,D)),function(e){e.classList.add("popup_is-opened"),e.classList.add("popup_is-animated"),document.addEventListener("click",t),document.addEventListener("keydown",n)}(e)}function M(e,t){var n=e.querySelector(".popup__button");n&&(n.textContent=t?"Сохранение...":"Сохранить")}fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){T=e._id,_.textContent=e.about,f.textContent=e.name,m.style.backgroundImage="url('".concat(e.avatar,"')")})).catch((function(e){console.log(e)})),fetch("".concat(o.baseUrl,"/cards"),{method:"GET",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=r(e,N,O,c,T);s.append(t)}))})).catch((function(e){console.log(e)})),x.addEventListener("click",(function(){var t;(t=A,fetch("".concat(o.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){U.remove(),A=null,U=null,e(L)})).catch((function(e){console.log(e)}))})),w.forEach((function(e,t){e.addEventListener("click",(function(){J(j[t])}))})),B.forEach((function(t){t.addEventListener("click",(function(){e(t.closest(".popup"))}))})),l.addEventListener("submit",(function(t){t.preventDefault(),M(t.target,!0);var n=d.value,r=p.value;f.textContent=n,_.textContent=r,function(e,t){return fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n,r).then((function(e){f.textContent=e.name,_.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){M(t.target,!1)})),e(k)})),y.addEventListener("submit",(function(t){var n;t.preventDefault(),M(t.target,!0),(n={name:v.value,link:h.value},fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){var n=r(t,N,O,c,T);s.prepend(n),e(E)})).catch((function(e){console.log(e)})).finally((function(){M(t.target,!1)}))})),P.addEventListener("click",(function(){J(C)})),S.addEventListener("submit",(function(t){t.preventDefault(),M(t.target,!0);var n=document.querySelector("#edit-profile").value;(function(e){return fetch("".concat(o.baseUrl,"/users/me/avatar "),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(n).then((function(){m.style.backgroundImage="url('".concat(n,"')"),e(C)})).catch((function(e){console.log(e)})).finally((function(){M(t.target,!1)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);i(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){i(n,o,t),function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?a(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t)}))}))}(t,e)}))}(D)})();
//# sourceMappingURL=main.js.map